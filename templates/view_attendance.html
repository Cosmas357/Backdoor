<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>View Attendance</title>
  <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet" />
</head>
<body>
  {% include 'navbar.html' %}

  <div class="container py-4">
    <h2 class="mb-4">View Attendance by Phaneroo Service</h2>

    <form method="POST"  class="mt-4">
      <div class="mb-3">
        <label for="center_id" class="form-label">Select Live-stream Center:</label>
        <select id="center_id" name="center_id" class="form-select" required>
          <option value="">-- Select Center --</option>
          {% for center in centers %}
            <option value="{{ center.id }}" {% if center.id == selected_center_id %}selected{% endif %}>
              {{ center.name }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="mb-4">
        <label for="service_number" class="form-label">Select Service Number:</label>
        <select id="service_number" name="service_number" class="form-select" required>
          <option value="">--Select--</option>
          {% for num in service_numbers %}
            <option value="{{ num }}" {% if num == selected_service %}selected{% endif %}>{{ num }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="d-flex gap-3">
        <button type="submit" class="btn btn-primary">View Attendance</button>
        <button type="submit" name="export" value="csv" class="btn btn-outline-secondary">Export as CSV</button>
      </div>
    </form>

    {% if records %}
      <div class="alert alert-info mt-4">
        Total Attendees: <strong>{{ records|length }}</strong> |
        First Timers: <strong>{{ first_timers_count }}</strong>
      </div>

      <form method="POST" action="{{ url_for('delete_attendance') }}">
        <input type="hidden" name="center_id" value="{{ selected_center_id }}">
        <input type="hidden" name="service_number" value="{{ selected_service }}">
   
        <table class="table table-striped table-bordered mt-3">
          <thead class="table-dark">
            <tr>
              <th>Select</th>
              <th>#</th>
              <th>Name</th>
              <th>Gender</th>
              <th>Contact</th>
              <th>Residence</th>
              <th>Home District</th>
              <th>Marital Status</th> 
              <th>Course/Profession</th>
              <th>Year of Study</th>
              <th>First Time</th>
              <th>Service-Date</th>
            </tr>
          </thead>
          <tbody>
            {% for record in records %}
              <tr>
                <td><input type="checkbox" name="delete_ids" value="{{ record.id }}"></td>
                <td>{{ loop.index }}</td>
                <td>{{ record.member.name }}</td>
                <td>{{ record.member.gender }}</td>
                <td>{{ record.member.contact }}</td>
                <td>{{ record.member.residence }}</td>
                <td>{{ record.member.home_district }}</td>
                <td>{{ record.member.marital_status }}</td>
                <td>{{ record.member.course_Profession }}</td>
                <td>{{ record.member.year_of_study }}</td>
                <td>{{ record.first_time }}</td>
                <td>{{ record.service_date.strftime('%Y-%m-%d') }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>

        <div class="mt-3">
          <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete selected records?')">Delete Selected</button>
        </div>
      </form>

    {% elif selected_service %}
      <div class="alert alert-warning mt-4">No attendance records found for Phaneroo {{ selected_service }} at {{ selected_center_id }}.</div>
    {% endif %}
  </div>
</body>
</html>
