<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mark Attendance</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@10.2.7/dist/css/autoComplete.min.css" rel="stylesheet" />
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  

</head>
<body>
  {% include 'navbar.html' %}

  <div class="container py-4">
    <h2>Mark Attendance</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
           <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div> 
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="POST">
      <!-- Center Dropdown -->
      <div class="mb-3">
        <label for="center_id" class="form-label">Live-stream Center *</label>
        <select class="form-select" id="center_id" name="center_id" required>
          <option value="">-- Select Center --</option>
          {% for center in centers %}
            <option value="{{ center.id }}" {% if center.id == selected_center_id %}selected{% endif %}>
              {{ center.name }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="mb-3">
        <label for="service_number" class="form-label">Service Number *</label>
        <input type="number" class="form-control" id="service_number" name="service_number" required min="1" />
      </div>

            <div class="mb-3">
  <label for="service_date" class="form-label ">Service Date</label>
  <input type="date" class="form-control" id="service_date" name="service_date" required>
</div>


      <div class="mb-3">
        <label for="member_name" class="form-label">Select Member *</label>
        <input id="member_name" name="member_name" class="form-control" placeholder="Start typing member name..." autocomplete="off" required />
        <input type="hidden" id="member_id" name="member_id" />
      </div>

      <button type="submit" class="btn btn-primary">Mark Attendance</button>
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@10.2.7/dist/autoComplete.min.js"></script>
  <script>
    const memberNames = JSON.parse('{{ member_names | tojson | safe }}');
    const memberDict = JSON.parse('{{ member_dict | tojson | safe }}');

    document.addEventListener("DOMContentLoaded", () => {
      const autoCompleteJS = new autoComplete({
        selector: "#member_name",
        placeHolder: "Start typing member name...",
        data: {
          src: memberNames,
          cache: true,
        },
        resultsList: {
          element: (list, data) => {
            if (!data.results.length) {
              const message = document.createElement("div");
              message.setAttribute("class", "no_result");
              message.innerHTML = `<span>No results found for "${data.query}"</span>`;
              list.appendChild(message);
            }
          },
          noResults: true,
          maxResults: 10,
          tabSelect: true
        },
        resultItem: {
          highlight: true
        },
        events: {
          input: {
            selection: (event) => {
              const selection = event.detail.selection.value;
              document.getElementById("member_name").value = selection;
              document.getElementById("member_id").value = memberDict[selection];
            }
          }
        }
      });
    });
  </script>
</body>
</html>
